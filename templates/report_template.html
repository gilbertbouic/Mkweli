<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MkweliAML Screening Report - {{ report.client_info.full_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            .container { max-width: 100% !important; }
            .alert { border: 1px solid #000 !important; }
            body { font-size: 12px; }
        }
        .report-header { 
            border-bottom: 3px solid #2c3e50; 
            padding-bottom: 1rem; 
            margin-bottom: 2rem; 
        }
        .hash-box { 
            background-color: #f8f9fa; 
            border: 2px dashed #6c757d; 
            padding: 1rem; 
            font-family: monospace;
            word-break: break-all;
            font-size: 0.8rem;
        }
        .company-logo {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .section-title {
            background-color: #f8f9fa;
            padding: 0.5rem;
            border-left: 4px solid #2c3e50;
            margin: 1rem 0;
            font-weight: bold;
        }
        .risk-high {
            color: #dc3545;
            font-weight: bold;
        }
        .risk-low {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container mt-4 mb-5">
        <!-- Report Header -->
        <div class="report-header">
            <div class="row">
                <div class="col-8">
                    <div class="company-logo">MkweliAML</div>
                    <h1>Client Screening Report</h1>
                    <p class="lead">Anti-Money Laundering & Know Your Customer Compliance</p>
                </div>
                <div class="col-4 text-end">
                    <h4>Report ID: {{ report.report_id }}</h4>
                    <p class="text-muted">Generated: {{ report.screening_date }}</p>
                </div>
            </div>
        </div>

        <!-- Client Information -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="section-title">1. Client Information</div>
                <table class="table table-bordered">
                    <tr>
                        <th width="20%">Full Name</th>
                        <td>{{ report.client_info.full_name }}</td>
                    </tr>
                    <tr>
                        <th>Client ID</th>
                        <td>{{ report.client_info.id }}</td>
                    </tr>
                    <tr>
                        <th>ID Number</th>
                        <td>{{ report.client_info.id_number or 'Not Provided' }}</td>
                    </tr>
                    <tr>
                        <th>Date of Birth</th>
                        <td>{{ report.client_info.date_of_birth or 'Not Provided' }}</td>
                    </tr>
                    <tr>
                        <th>Address</th>
                        <td>{{ report.client_info.address or 'Not Provided' }}</td>
                    </tr>
                    <tr>
                        <th>Client Since</th>
                        <td>{{ report.client_info.created_at[:10] }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Screening Results -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="section-title">2. Screening Results</div>
                
                <!-- Risk Assessment -->
                <div class="alert {% if report.risk_level == 'high' %}alert-danger{% else %}alert-success{% endif %}">
                    <h4 class="alert-heading">
                        {% if report.risk_level == 'high' %}üö® {% endif %}
                        {{ report.risk_assessment }}
                    </h4>
                    <p class="mb-0">
                        {% if report.matches_found > 0 %}
                            {{ report.matches_found }} potential match(es) found in sanctions lists.
                        {% else %}
                            No matches found in sanctions lists screened.
                        {% endif %}
                    </p>
                </div>

                <!-- Matches Found -->
                {% if report.matches_found > 0 %}
                <h5>Potential Matches Found:</h5>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Name</th>
                                <th>Source List</th>
                                <th>Additional Information</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for match in report.matches %}
                            <tr>
                                <td>{{ match.full_name }}</td>
                                <td><span class="badge bg-secondary">{{ match.source_list }}</span></td>
                                <td>{{ match.other_info or '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sanctions Lists Used -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="section-title">3. Sanctions Lists Screened</div>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>List Name</th>
                                <th>Last Updated</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for list in report.sanctions_lists_used %}
                            <tr>
                                <td>{{ list.list_name }}</td>
                                <td>
                                    {% if list.last_updated %}
                                        {{ list.last_updated[:10] }}
                                    {% else %}
                                        <span class="text-danger">Never</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if list.last_updated %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-warning">Not Loaded</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Data Integrity Verification -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="section-title">4. Data Integrity Verification</div>
                <div class="hash-box">
                    <strong>SHA-256 Hash:</strong><br>
                    {{ report.sha256_hash }}
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        <strong>Verification Note:</strong> This hash is generated from the exact report content. 
                        Any alteration to this document will change the hash value, indicating tampering.
                        To verify, compare this hash with the system-generated hash.
                    </small>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row mt-5">
            <div class="col-12 text-center">
                <hr>
                <p class="text-muted">
                    <strong>MkweliAML Compliance Software</strong><br>
                    Generated on {{ report.screening_date }} | Report ID: {{ report.report_id }}<br>
                    This report is valid only with intact SHA-256 hash verification.
                </p>
            </div>
        </div>

        <!-- Print Button -->
        <div class="row no-print">
            <div class="col-12 text-center mt-4">
                <button onclick="window.print()" class="btn btn-primary">üñ®Ô∏è Print Report</button>
                 <div class="mt-2">
                    <small class="text-muted">
                        Tip: Use "Save as PDF" in your browser's print dialog to create a PDF version.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
