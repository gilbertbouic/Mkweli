{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Sanctions Lists Management</h1>
</div>

<div class="row">
    <!-- Available Lists & Links -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Download Sanctions Lists</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Visit these official sources to download the latest sanctions lists:</p>
                
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>List Name</th>
                                <th>Source</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>OFAC SDN List</td>
                                <td><span class="badge bg-secondary">USA</span></td>
                                <td>
                                    <a href="https://home.treasury.gov/policy-issues/financial-sanctions/specially-designated-nationals-and-blocked-persons-list-sdn-human-readable-lists" 
                                       target="_blank" class="btn btn-sm btn-outline-primary">
                                        Visit Source
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>UN Consolidated List</td>
                                <td><span class="badge bg-secondary">UN</span></td>
                                <td>
                                    <a href="https://www.un.org/securitycouncil/content/un-sc-consolidated-list" 
                                       target="_blank" class="btn btn-sm btn-outline-primary">
                                        Visit Source
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>EU Consolidated List</td>
                                <td><span class="badge bg-secondary">EU</span></td>
                                <td>
                                    <a href="https://www.sanctionsmap.eu/#/main" 
                                       target="_blank" class="btn btn-sm btn-outline-primary">
                                        Visit Source
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>UK Consolidated List</td>
                                <td><span class="badge bg-secondary">UK</span></td>
                                <td>
                                    <a href="https://www.gov.uk/government/publications/the-uk-sanctions-list" 
                                       target="_blank" class="btn btn-sm btn-outline-primary">
                                        Visit Source
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>Singapore Consolidated List</td>
                                <td><span class="badge bg-secondary">Singapore</span></td>
                                <td>
                                    <a href="https://www.mas.gov.sg/regulation/anti-money-laundering/targeted-financial-sanctions/lists-of-designated-individuals-and-entities" 
                                       target="_blank" class="btn btn-sm btn-outline-primary">
                                        Visit Source
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
              
            </div>
        </div>
    </div>

    <!-- Import Section -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Import Sanctions List</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('import_sanctions_list') }}" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="list_name" class="form-label">Select List to Import</label>
                        <select class="form-select" id="list_name" name="list_name" required>
                            <option value="">Choose a list...</option>
                            <option value="OFAC SDN">OFAC SDN List</option>
                            <option value="UN Consolidated">UN Consolidated List</option>
                            <option value="EU Consolidated">EU Consolidated List</option>
                            <option value="UK Consolidated">UK Consolidated List</option>
                            <option value="Singapore Consolidated">Singapore Consolidated List</option>
                            <option value="Other">Other List</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="csv_file" class="form-label">CSV File</label>
                        <input type="file" class="form-control" id="csv_file" name="csv_file" accept=".csv" required>
                        <div class="form-text">
                            Upload the CSV file you downloaded. The system expects columns: ID, Name, Additional Info.
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Import List</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Current Lists Status -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Current Lists Status</h5>
            </div>
            <div class="card-body">
                {% if list_status %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>List Name</th>
                                <th>Last Updated</th>
                                <th>Entries in Database</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for list in list_status %}
                            <tr>
                                <td>{{ list.list_name }}</td>
                                <td>
                                    {% if list.last_updated %}
                                        {{ list.last_updated[:16] }}
                                    {% else %}
                                        <span class="text-danger">Never</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if list_counts and list.list_name in list_counts %}
                                        <span class="badge bg-info">{{ list_counts[list.list_name] }} entries</span>
                                    {% else %}
                                        <span class="badge bg-warning">0 entries</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('clear_sanctions_list', list_name=list.list_name) }}" 
                                       class="btn btn-sm btn-outline-danger"
                                       onclick="return confirm('Are you sure you want to clear all entries for {{ list.list_name }}?')">
                                        Clear List
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <p class="text-muted">No sanctions lists have been imported yet.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Instructions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Import Instructions</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Click "Visit Source" for the sanctions list you want to update</li>
                    <li>Download CSV/XML formats to your computer</li>
                    <li>Convert XML to CSV (see README for links)</li>
                    <li>Select the list name from the dropdown above</li>
                    <li>Click "Choose File" and select the downloaded file</li>
                    <li>Click "Import List" to update the database</li>
                    <li>The dashboard will now show the updated "Last Updated" date</li>
                </ol>
                
                <div class="alert alert-warning">
                    <small>
                        <strong>Recommended:</strong> Update sanctions lists monthly to ensure compliance.
                        The system will use the most recently imported data for all screenings.
                    </small>
                </div>

                <div class="alert alert-info">
                    <small>
                        <strong>CSV Format:</strong> The system expects CSV files with these columns:
                        <ul>
                            <li>Column 1: ID or Reference Number</li>
                            <li>Column 2: Full Name</li>
                            <li>Columns 3+: Additional Information (address, type of sanction, etc.)</li>
                        </ul>
                        The first row (header) is automatically skipped.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
